

## åŸºæœ¬è¦æ±‚

Electronæ˜¯ä¸€ä¸ªä½¿ç”¨ JavaScriptã€HTML å’Œ CSS æ„å»ºæ¡Œé¢åº”ç”¨ç¨‹åºçš„æ¡†æ¶ã€‚ Electron å°† [Chromium](https://www.chromium.org/) å’Œ [Node.js](https://nodejs.org/) åµŒå…¥åˆ°äº†ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œå› æ­¤å®ƒå…è®¸ä½ ä»…éœ€ä¸€ä¸ªä»£ç ä»“åº“ï¼Œå°±å¯ä»¥æ’°å†™æ”¯æŒ Windowsã€macOS å’Œ Linux çš„è·¨å¹³å°åº”ç”¨ã€‚

æœ¬æ•™ç¨‹å°†æŒ‡å¯¼æ‚¨ä½¿ç”¨ Electron å¼€å‘ä¸€ä¸ªæ¡Œé¢åº”ç”¨ï¼Œå¹¶å°†å…¶åˆ†å‘ç»™ç»ˆç«¯ç”¨æˆ·ã€‚

#### ç›®æ ‡

æœ¬æ•™ç¨‹é¦–å…ˆæŒ‡å¯¼æ‚¨å®Œæˆä»å¤´å¼€å§‹æ‹¼å‡‘ä¸€ä¸ªæœ€å°çš„ Electron åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ï¼Œç„¶åæ•™æ‚¨å¦‚ä½•ä½¿ç”¨ Electron Forge æ‰“åŒ…å¹¶å°†å…¶åˆ†å‘ç»™ç”¨æˆ·ã€‚

å¦‚æœæ‚¨å¸Œæœ›ä»å•å‘½ä»¤æ ·æ¿å¼€å§‹é¡¹ç›®ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨ Electron Forge çš„ create-electron-app å‘½ä»¤ã€‚

#### å‰è¨€

Electron æ˜¯ç½‘é¡µåº”ç”¨ (web apps) çš„ä¸€ä¸ªåŸç”ŸåŒ…è£…å±‚ï¼Œåœ¨ Node.js ç¯å¢ƒä¸­è¿è¡Œã€‚ å› æ­¤ï¼Œæœ¬æ•™ç¨‹å‡è®¾æ‚¨å·²ç»å¯¹ Node.js å’Œå‰ç«¯ Web å¼€å‘æœ‰ä¸€å®šåœ°äº†è§£ã€‚ å¦‚æœæ‚¨è¿˜éœ€è¦äº†è§£ä¸€äº›èƒŒæ™¯çŸ¥è¯†ï¼Œæˆ‘ä»¬æ¨èæ‚¨é˜…è¯»ï¼š

- [Web å…¥é—¨ (MDN Web Docs)](https://developer.mozilla.org/en-US/docs/Learn/)
- [NodeJSå®˜æ–¹å…¥é—¨æŒ‡å—](https://nodejs.dev/en/learn/)

#### æ‰€éœ€å·¥å…·

ç•¥



## åˆ›å»ºé¡¹ç›®

#### åˆå§‹åŒ– npm é¡¹ç›®

Electron åº”ç”¨åŸºäº npm æ­å»ºï¼Œä»¥ package.json æ–‡ä»¶ä½œä¸ºå…¥å£ç‚¹ã€‚ é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨å…¶ä¸­æ‰§è¡Œ `npm init` åˆå§‹åŒ–é¡¹ç›®ã€‚

```sh
mkdir my-electron-app && cd my-electron-app
npm init
```

è¿™æ¡å‘½ä»¤ä¼šå¸®æ‚¨é…ç½® package.json ä¸­çš„ä¸€äº›å­—æ®µã€‚ ä¸ºæœ¬æ•™ç¨‹çš„ç›®çš„ï¼Œæœ‰å‡ æ¡è§„åˆ™éœ€è¦éµå¾ªï¼š

- *å…¥å£ç‚¹* åº”å½“æ˜¯ `main.js` (æ‚¨å¾ˆå¿«å°±ä¼šåˆ›å»ºå®ƒ)
- *author*ã€*license* å’Œ *description*å¯ä¸ºä»»æ„å€¼ï¼Œä½†å¯¹äº [åº”ç”¨æ‰“åŒ…](https://www.electronjs.org/zh/docs/latest/tutorial/æ‰“åŒ…æ•™ç¨‹) æ˜¯å¿…å¡«é¡¹ã€‚

ç„¶åï¼Œå°† Electron å®‰è£…ä¸ºæ‚¨é¡¹ç›®çš„ **devDependencies**ï¼Œå³ä»…åœ¨å¼€å‘ç¯å¢ƒéœ€è¦çš„é¢å¤–ä¾èµ–ã€‚

> ä¸ºä»€ä¹ˆ ELECTRON æ˜¯ DEVDEPENDENCY?
>
> æ‚¨çš„åº”ç”¨éœ€è¦è¿è¡Œ Electron APIï¼Œå› æ­¤è¿™å¬ä¸Šå»å¯èƒ½æœ‰ç‚¹åç›´è§‰ã€‚ å®é™…ä¸Šï¼Œæ‰“åŒ…åçš„åº”ç”¨æœ¬èº«ä¼šåŒ…å« Electron çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå› æ­¤ä¸éœ€è¦å°† Electron ä½œä¸ºç”Ÿäº§ç¯å¢ƒä¾èµ–ã€‚

```sh
npm install electron --save-dev
```

åœ¨åˆå§‹åŒ–å¹¶ä¸”å®‰è£…å®Œ Electron ä¹‹åï¼Œæ‚¨çš„ package.json åº”è¯¥é•¿ä¸‹é¢è¿™æ ·ã€‚ æ–‡ä»¶å¤¹ä¸­ä¼šå‡ºç°ä¸€ä¸ª `node_modules` æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«äº† Electron å¯æ‰§è¡Œæ–‡ä»¶ï¼›è¿˜æœ‰ä¸€ä¸ª `package-lock.json` æ–‡ä»¶ï¼ŒæŒ‡å®šäº†å„ä¸ªä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬ã€‚

```json
{
  "name": "my-electron-app",
  "version": "1.0.0",
  "description": "Hello World!",
  "main": "main.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "Jane Doe",
  "license": "MIT",
  "devDependencies": {
    "electron": "23.1.3"
  }
}
```

> é«˜çº§å®‰è£…æ­¥éª¤
>
> å¦‚æœç›´æ¥å®‰è£… Electron å¤±è´¥ï¼Œè¯·å‚è€ƒæˆ‘ä»¬çš„ [å®‰è£…æŒ‡å¯¼](https://www.electronjs.org/zh/docs/latest/tutorial/installation) æ–‡æ¡£ï¼Œäº†è§£æœ‰å…³ä¸‹è½½é•œåƒã€ä»£ç†å’Œæ•…éšœæ’é™¤æ­¥éª¤çš„è¯´æ˜ã€‚

#### æ·»åŠ  .gitignore æ–‡ä»¶

[`.gitignore`](https://git-scm.com/docs/gitignore) æ–‡ä»¶å¯ä»¥æŒ‡å®šå“ªäº›æ–‡ä»¶å’Œç›®å½•åº”è¯¥åœ¨Gitä¸­ä¸è¢«è·Ÿè¸ªã€‚ å»ºè®®æ‚¨å¤åˆ¶ä¸€ä»½ [GitHub çš„ Node.js gitignore æ¨¡æ¿](https://github.com/github/gitignore/blob/main/Node.gitignore) åˆ°æ‚¨é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œä»¥é¿å…å°† `node_modules` æ–‡ä»¶å¤¹æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ã€‚



#### è¿è¡Œ Electron åº”ç”¨

å‚é˜… [Electron è¿›ç¨‹æ¨¡å‹ï¼ˆprocess modelï¼‰](https://www.electronjs.org/zh/docs/latest/tutorial/process-model) ç›¸å…³æ–‡æ¡£æ¥äº†è§£ Electron çš„è¿›ç¨‹ä¹‹é—´æ˜¯å¦‚ä½•åä½œçš„ã€‚

æ‚¨åœ¨ package.json ä¸­æŒ‡å®šçš„ [`main`](https://docs.npmjs.com/cli/v7/configuring-npm/package-json#main) æ–‡ä»¶æ˜¯ Electron åº”ç”¨çš„å…¥å£ã€‚ è¿™ä¸ªæ–‡ä»¶æ§åˆ¶ **ä¸»ç¨‹åº (main process)**ï¼Œå®ƒè¿è¡Œåœ¨ Node.js ç¯å¢ƒé‡Œï¼Œè´Ÿè´£æ§åˆ¶æ‚¨åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸã€æ˜¾ç¤ºåŸç”Ÿç•Œé¢ã€æ‰§è¡Œç‰¹æ®Šæ“ä½œå¹¶ç®¡ç†æ¸²æŸ“å™¨è¿›ç¨‹ (renderer processes)ï¼Œç¨åä¼šè¯¦ç»†ä»‹ç»ã€‚

åœ¨ç»§ç»­ç¼–å†™æ‚¨çš„ Electron åº”ç”¨ä¹‹å‰ï¼Œæ‚¨å°†ä½¿ç”¨ä¸€ä¸ªå°å°çš„è„šæœ¬æ¥ç¡®ä¿ä¸»è¿›ç¨‹å…¥å£ç‚¹å·²ç»é…ç½®æ­£ç¡®ã€‚ åœ¨æ ¹ç›®å½•çš„ `main.js` æ–‡ä»¶ä¸­å†™ä¸€è¡Œä»£ç ï¼š

```js
console.log('Hello from Electron ğŸ‘‹')
```

ç”±äº Electron çš„ä¸»è¿›ç¨‹æ˜¯ä¸€ä¸ª Node.js è¿è¡Œæ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `electron` å‘½ä»¤æ‰§è¡Œä»»æ„çš„ Node.js ä»£ç  (ç”šè‡³å¯ä»¥å°†å…¶ä½œä¸º [REPL](https://www.electronjs.org/zh/docs/latest/tutorial/repl) ä½¿ç”¨)ã€‚ è¦æ‰§è¡Œè¿™ä¸ªè„šæœ¬ï¼Œéœ€è¦åœ¨ package.json çš„ [`scripts`](https://docs.npmjs.com/cli/v7/using-npm/scripts) å­—æ®µä¸­æ·»åŠ ä¸€ä¸ª `start` å‘½ä»¤ï¼Œå†…å®¹ä¸º `electron .` ã€‚ è¿™ä¸ªå‘½ä»¤ä¼šå‘Šè¯‰ Electron åœ¨å½“å‰ç›®å½•ä¸‹å¯»æ‰¾ä¸»è„šæœ¬ï¼Œå¹¶ä»¥å¼€å‘æ¨¡å¼è¿è¡Œå®ƒã€‚

```json
{
  "name": "my-electron-app",
  "version": "1.0.0",
  "description": "Hello World!",
  "main": "main.js",
  "scripts": {
    "start": "electron .",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "Jane Doe",
  "license": "MIT",
  "devDependencies": {
    "electron": "23.1.3"
  }
}
```

```sh
npm run start
```

æ‚¨çš„ç»ˆç«¯åº”è¯¥ä¼šè¾“å‡º `æ¬¢è¿æ¥åˆ° Electron ğŸ‘‹`ã€‚ æ­å–œï¼Œæ‚¨å·²ç»åœ¨ Electron ä¸­æ‰§è¡Œäº†æ‚¨çš„ç¬¬ä¸€è¡Œä»£ç ï¼ æ¥ä¸‹æ¥ï¼Œæ‚¨ä¼šå­¦ä¹ å¦‚ä½•ç”¨ HTML åˆ›å»ºç”¨æˆ·ç•Œé¢ï¼Œå¹¶å°†å®ƒä»¬è£…è½½åˆ°åŸç”Ÿçª—å£ä¸­ã€‚



#### å°†ç½‘é¡µè£…è½½åˆ° BrowserWindow

åœ¨ Electron ä¸­ï¼Œæ¯ä¸ªçª—å£å±•ç¤ºä¸€ä¸ªé¡µé¢ï¼Œåè€…å¯ä»¥æ¥è‡ªæœ¬åœ°çš„ HTMLï¼Œä¹Ÿå¯ä»¥æ¥è‡ªè¿œç¨‹ URLã€‚ åœ¨æœ¬ä¾‹ä¸­ï¼Œæ‚¨å°†ä¼šè£…è½½æœ¬åœ°çš„æ–‡ä»¶ã€‚ åœ¨æ‚¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª `index.html` æ–‡ä»¶ï¼Œå¹¶å†™å…¥ä¸‹é¢çš„å†…å®¹ï¼š

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self'"
    />
    <meta
      http-equiv="X-Content-Security-Policy"
      content="default-src 'self'; script-src 'self'"
    />
    <title>Hello from Electron renderer!</title>
  </head>
  <body>
    <h1>Hello from Electron renderer!</h1>
    <p>ğŸ‘‹</p>
  </body>
</html>
```

ç°åœ¨æ‚¨æœ‰äº†ä¸€ä¸ªç½‘é¡µï¼Œæ‚¨å¯ä»¥å°†å…¶åŠ è½½åˆ°ä¸€ä¸ª Electron çš„ [BrowserWindow](https://www.electronjs.org/zh/docs/latest/api/browser-window) ä¸Šäº†ã€‚ å°† `main.js` ä¸­çš„å†…å®¹æ›¿æ¢æˆä¸‹åˆ—ä»£ç ã€‚ æˆ‘ä»¬é©¬ä¸Šä¼šé€è¡Œè§£é‡Šã€‚

```js
const { app, BrowserWindow } = require('electron')

const createWindow = () => {
  const win = new BrowserWindow({
    width: 800,
    height: 600
  })

  win.loadFile('index.html')
}

app.whenReady().then(() => {
  createWindow()
})
```

###### å¯¼å…¥æ¨¡å—

```js
const { app, BrowserWindow } = require('electron')
```

åœ¨ç¬¬ä¸€è¡Œä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ CommonJS è¯­æ³•å¯¼å…¥äº†ä¸¤ä¸ª Electron æ¨¡å—ï¼š

- [app](https://www.electronjs.org/zh/docs/latest/api/app)ï¼Œå®ƒç€æ‚¨åº”ç”¨ç¨‹åºçš„äº‹ä»¶ç”Ÿå‘½å‘¨æœŸã€‚
- [BrowserWindow](https://www.electronjs.org/zh/docs/latest/api/browser-window)ï¼Œå®ƒè´Ÿè´£åˆ›å»ºå’Œç®¡ç†åº”ç”¨çª—å£ã€‚

> æ‚¨å¯èƒ½æ³¨æ„åˆ°äº† **a**pp å’Œ **B**rowser**W**indow ä¸¤ä¸ªæ¨¡å—åçš„å¤§å°å†™å·®å¼‚ã€‚ Electron éµå¾ª JavaScript ä¼ ç»Ÿçº¦å®šï¼Œä»¥å¸•æ–¯å¡å‘½åæ³• (PascalCase) å‘½åå¯å®ä¾‹åŒ–çš„ç±» (å¦‚ BrowserWindow, Tray å’Œ Notification)ï¼Œä»¥é©¼å³°å‘½åæ³• (camelCase) å‘½åä¸å¯å®ä¾‹åŒ–çš„å‡½æ•°ã€å˜é‡ç­‰ (å¦‚ app, ipcRenderer, webContents) ã€‚

> For better type checking when writing TypeScript code, you can choose to import main process modules from `electron/main`.
>
> ```js
> const { app, BrowserWindow } = require('electron/main')
> ```
>
> For more information, see the [Process Model docs](https://www.electronjs.org/zh/docs/latest/tutorial/process-model#process-specific-module-aliases-typescript).

###### å°†å¯å¤ç”¨çš„å‡½æ•°å†™å…¥å®ä¾‹åŒ–çª—å£

`createWindow()` å‡½æ•°å°†æ‚¨çš„é¡µé¢åŠ è½½åˆ°æ–°çš„ BrowserWindow å®ä¾‹ä¸­ï¼š

```js
const createWindow = () => {
  const win = new BrowserWindow({
    width: 800,
    height: 600
  })

  win.loadFile('index.html')
}
```

###### åœ¨åº”ç”¨å‡†å¤‡å°±ç»ªæ—¶è°ƒç”¨å‡½æ•°

```js
app.whenReady().then(() => {
  createWindow()
})
```

Electron çš„è®¸å¤šæ ¸å¿ƒæ¨¡å—éƒ½æ˜¯ Node.js çš„[äº‹ä»¶è§¦å‘å™¨](https://nodejs.org/api/events.html#events)ï¼Œéµå¾ª Node.js çš„å¼‚æ­¥äº‹ä»¶é©±åŠ¨æ¶æ„ã€‚ app æ¨¡å—å°±æ˜¯å…¶ä¸­ä¸€ä¸ªã€‚

åœ¨ Electron ä¸­ï¼Œåªæœ‰åœ¨ app æ¨¡å—çš„ [`ready`](https://www.electronjs.org/zh/docs/latest/api/app#event-ready) äº‹ä»¶è§¦å‘åæ‰èƒ½åˆ›å»º BrowserWindows å®ä¾‹ã€‚ æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ [`app.whenReady()`](https://www.electronjs.org/zh/docs/latest/api/app#appwhenready) API æ¥ç›‘å¬æ­¤äº‹ä»¶ï¼Œå¹¶åœ¨å…¶æˆåŠŸåè°ƒç”¨ `createWindow()` æ–¹æ³•ã€‚

> Info
>
> é€šå¸¸æˆ‘ä»¬ä½¿ç”¨è§¦å‘å™¨çš„ `.on` å‡½æ•°æ¥ç›‘å¬ Node.js äº‹ä»¶ã€‚
>
> ```diff
> + app.on('ready', () => {
> - app.whenReady().then(() => {
>   createWindow()
> })
> ```
>
> ä½†æ˜¯ Electron æš´éœ²äº† `app.whenReady()` æ–¹æ³•ï¼Œä½œä¸ºå…¶ `ready` äº‹ä»¶çš„ä¸“ç”¨ç›‘å¬å™¨ï¼Œè¿™æ ·å¯ä»¥é¿å…ç›´æ¥ç›‘å¬ .on äº‹ä»¶å¸¦æ¥çš„ä¸€äº›é—®é¢˜ã€‚ å‚è§ [electron/electron#21972](https://github.com/electron/electron/pull/21972) ã€‚1

æ­¤æ—¶ï¼Œè¿è¡Œ `start` å‘½ä»¤åº”è¯¥èƒ½æˆåŠŸåœ°æ‰“å¼€ä¸€ä¸ªåŒ…å«æ‚¨ç½‘é¡µå†…å®¹çš„çª—å£ï¼

æ‚¨åº”ç”¨ä¸­çš„æ¯ä¸ªé¡µé¢éƒ½åœ¨ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ä¸­è¿è¡Œï¼Œæˆ‘ä»¬ç§°è¿™äº›è¿›ç¨‹ä¸º **æ¸²æŸ“å™¨ (\*renderer\*)** ã€‚ æ¸²æŸ“è¿›ç¨‹ä½¿ç”¨ä¸å¸¸è§„Webå¼€å‘ç›¸åŒçš„JavaScript APIå’Œå·¥å…·ï¼Œä¾‹å¦‚ä½¿ç”¨ [webpack](https://webpack.js.org/)æ¥æ‰“åŒ…å’Œå‹ç¼©æ‚¨çš„ä»£ç ï¼Œæˆ–ä½¿ç”¨ [React](https://reactjs.org/) æ„å»ºç”¨æˆ·ç•Œé¢ã€‚

#### ç®¡ç†åº”ç”¨çš„çª—å£ç”Ÿå‘½å‘¨æœŸ

åº”ç”¨çª—å£åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸­çš„è¡Œä¸ºä¹Ÿä¸åŒã€‚ Electron å…è®¸æ‚¨è‡ªè¡Œå®ç°è¿™äº›è¡Œä¸ºæ¥éµå¾ªæ“ä½œç³»ç»Ÿçš„è§„èŒƒï¼Œè€Œä¸æ˜¯é‡‡ç”¨é»˜è®¤çš„å¼ºåˆ¶æ‰§è¡Œã€‚ æ‚¨å¯ä»¥é€šè¿‡ç›‘å¬ app å’Œ BrowserWindow æ¨¡ç»„çš„äº‹ä»¶ï¼Œè‡ªè¡Œå®ç°åŸºç¡€çš„åº”ç”¨çª—å£è§„èŒƒã€‚

> é€šè¿‡æ£€æŸ¥ Node.js çš„ [`process.platform`](https://nodejs.org/api/process.html#process_process_platform) å˜é‡ï¼Œæ‚¨å¯ä»¥é’ˆå¯¹ç‰¹å®šå¹³å°è¿è¡Œç‰¹å®šä»£ç ã€‚ è¯·æ³¨æ„ï¼ŒElectron ç›®å‰åªæ”¯æŒä¸‰ä¸ªå¹³å°ï¼š`win32` (Windows), `linux` (Linux) å’Œ `darwin` (macOS) ã€‚

###### å…³é—­æ‰€æœ‰çª—å£æ—¶é€€å‡ºåº”ç”¨ (Windows & Linux)

åœ¨ Windows å’Œ Linux ä¸Šï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›åœ¨å…³é—­ä¸€ä¸ªåº”ç”¨çš„æ‰€æœ‰çª—å£åè®©å®ƒé€€å‡ºã€‚ è¦åœ¨æ‚¨çš„Electronåº”ç”¨ä¸­å®ç°è¿™ä¸€ç‚¹ï¼Œæ‚¨å¯ä»¥ç›‘å¬ app æ¨¡å—çš„ [`window-all-closed`](https://www.electronjs.org/zh/docs/latest/api/app#event-window-all-closed) äº‹ä»¶ï¼Œå¹¶è°ƒç”¨ [`app.quit()`](https://www.electronjs.org/zh/docs/latest/api/app#appquit) æ¥é€€å‡ºæ‚¨çš„åº”ç”¨ç¨‹åºã€‚æ­¤æ–¹æ³•ä¸é€‚ç”¨äº macOSã€‚

```js
app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') app.quit()
})
```

###### å¦‚æœæ²¡æœ‰çª—å£æ‰“å¼€åˆ™æ‰“å¼€ä¸€ä¸ªçª—å£ (macOS)

ä¸å‰äºŒè€…ç›¸æ¯”ï¼Œå³ä½¿æ²¡æœ‰æ‰“å¼€ä»»ä½•çª—å£ï¼ŒmacOS åº”ç”¨é€šå¸¸ä¹Ÿä¼šç»§ç»­è¿è¡Œã€‚ åœ¨æ²¡æœ‰çª—å£å¯ç”¨æ—¶è°ƒç”¨ app ä¼šæ‰“å¼€ä¸€ä¸ªæ–°çª—å£ã€‚

ä¸ºäº†å®ç°è¿™ä¸€ç‰¹æ€§ï¼Œå¯ä»¥ç›‘å¬æ¨¡ç»„çš„ [`activate`](https://www.electronjs.org/zh/docs/latest/api/app#event-activate-macos) äº‹ä»¶ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•æ´»åŠ¨çš„ BrowserWindowï¼Œè°ƒç”¨ `createWindow()` æ–¹æ³•æ–°å»ºä¸€ä¸ªã€‚

å› ä¸ºçª—å£æ— æ³•åœ¨ `ready` äº‹ä»¶å‰åˆ›å»ºï¼Œä½ åº”å½“åœ¨ä½ çš„åº”ç”¨åˆå§‹åŒ–åä»…ç›‘å¬ `activate` äº‹ä»¶ã€‚ è¦å®ç°è¿™ä¸ªï¼Œä»…ç›‘å¬ `whenReady()` å›è°ƒå³å¯ã€‚

```js
app.whenReady().then(() => {
  createWindow()

  app.on('activate', () => {
    if (BrowserWindow.getAllWindows().length === 0) createWindow()
  })
})
```



## ä½¿ç”¨é¢„åŠ è½½è„šæœ¬

#### ä»€ä¹ˆæ˜¯é¢„åŠ è½½è„šæœ¬

Electron çš„ä¸»è¿›ç¨‹æ˜¯ä¸€ä¸ªæ‹¥æœ‰ç€å®Œå…¨æ“ä½œç³»ç»Ÿè®¿é—®æƒé™çš„ Node.js ç¯å¢ƒã€‚ é™¤äº† [Electron æ¨¡ç»„](https://www.electronjs.org/zh/docs/latest/api/app) ä¹‹å¤–ï¼Œæ‚¨ä¹Ÿå¯ä»¥è®¿é—® [Node.js å†…ç½®æ¨¡å—](https://nodejs.org/dist/latest/docs/api/) å’Œæ‰€æœ‰é€šè¿‡ npm å®‰è£…çš„åŒ…ã€‚ å¦ä¸€æ–¹é¢ï¼Œå‡ºäºå®‰å…¨åŸå› ï¼Œæ¸²æŸ“è¿›ç¨‹é»˜è®¤è·‘åœ¨ç½‘é¡µé¡µé¢ä¸Šï¼Œè€Œå¹¶é Node.jsé‡Œã€‚

**ä¸ºäº†å°† Electron çš„ä¸åŒç±»å‹çš„è¿›ç¨‹æ¡¥æ¥åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨è¢«ç§°ä¸º é¢„åŠ è½½ çš„ç‰¹æ®Šè„šæœ¬ã€‚**

#### ä½¿ç”¨é¢„åŠ è½½è„šæœ¬æ¥å¢å¼ºæ¸²æŸ“å™¨

BrowserWindow çš„é¢„åŠ è½½è„šæœ¬è¿è¡Œåœ¨å…·æœ‰ HTML DOM å’Œ Node.jsã€Electron API çš„æœ‰é™å­é›†è®¿é—®æƒé™çš„ç¯å¢ƒä¸­ã€‚

ä» Electron 20 å¼€å§‹ï¼Œé¢„åŠ è½½è„šæœ¬é»˜è®¤ **æ²™ç›’åŒ–** ï¼Œä¸å†æ‹¥æœ‰å®Œæ•´ Node.js ç¯å¢ƒçš„è®¿é—®æƒã€‚ å®é™…ä¸Šï¼Œè¿™æ„å‘³ç€ä½ åªæ‹¥æœ‰ä¸€ä¸ª polyfilled çš„ `require` å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åªèƒ½è®¿é—®ä¸€ç»„æœ‰é™çš„ APIã€‚

| å¯ç”¨çš„ API            | è¯¦ç»†ä¿¡æ¯                                                     |
| --------------------- | ------------------------------------------------------------ |
| Electron æ¨¡å—         | æ¸²æŸ“è¿›ç¨‹æ¨¡å—                                                 |
| Node.js æ¨¡å—          | [`events`](https://nodejs.org/api/events.html)ã€[`timers`](https://nodejs.org/api/timers.html)ã€[`url`](https://nodejs.org/api/url.html) |
| Polyfilled çš„å…¨å±€æ¨¡å— | [`Buffer`](https://nodejs.org/api/buffer.html)ã€[`process`](https://www.electronjs.org/zh/docs/latest/api/process)ã€[`clearImmediate`](https://nodejs.org/api/timers.html#timers_clearimmediate_immediate)ã€[`setImmediate`](https://nodejs.org/api/timers.html#timers_setimmediate_callback_args) |

æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·é˜…è¯» [æ²™ç›’è¿›ç¨‹](https://www.electronjs.org/zh/docs/latest/tutorial/sandbox) æ•™ç¨‹ã€‚

ä¸ Chrome æ‰©å±•çš„[å†…å®¹è„šæœ¬](https://developer.chrome.com/docs/extensions/mv3/content_scripts/)ï¼ˆContent Scriptï¼‰ç±»ä¼¼ï¼Œé¢„åŠ è½½è„šæœ¬åœ¨æ¸²æŸ“å™¨åŠ è½½ç½‘é¡µä¹‹å‰æ³¨å…¥ã€‚ å¦‚æœä½ æƒ³ä¸ºæ¸²æŸ“å™¨æ·»åŠ éœ€è¦ç‰¹æ®Šæƒé™çš„åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡ [contextBridge](https://www.electronjs.org/zh/docs/latest/api/context-bridge) æ¥å£å®šä¹‰ [å…¨å±€å¯¹è±¡](https://developer.mozilla.org/en-US/docs/Glossary/Global_object)ã€‚

ä¸ºäº†æ¼”ç¤ºè¿™ä¸€æ¦‚å¿µï¼Œä½ å°†ä¼šåˆ›å»ºä¸€ä¸ªå°†åº”ç”¨ä¸­çš„ Chromeã€Nodeã€Electron ç‰ˆæœ¬å·æš´éœ²è‡³æ¸²æŸ“å™¨çš„é¢„åŠ è½½è„šæœ¬

æ–°å»ºä¸€ä¸ª `preload.js` æ–‡ä»¶ã€‚è¯¥è„šæœ¬é€šè¿‡ `versions` è¿™ä¸€å…¨å±€å˜é‡ï¼Œå°† Electron çš„ `process.versions` å¯¹è±¡æš´éœ²ç»™æ¸²æŸ“å™¨ã€‚

```js
const { contextBridge } = require('electron')

contextBridge.exposeInMainWorld('versions', {
  node: () => process.versions.node,
  chrome: () => process.versions.chrome,
  electron: () => process.versions.electron
  // é™¤å‡½æ•°ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æš´éœ²å˜é‡
})
```

ä¸ºäº†å°†è„šæœ¬é™„åœ¨æ¸²æŸ“è¿›ç¨‹ä¸Šï¼Œåœ¨ BrowserWindow æ„é€ å™¨ä¸­ä½¿ç”¨ `webPreferences.preload` ä¼ å…¥è„šæœ¬çš„è·¯å¾„ã€‚

```js
const { app, BrowserWindow } = require('electron')
const path = require('node:path')

const createWindow = () => {
  const win = new BrowserWindow({
    width: 800,
    height: 600,
    webPreferences: {
      preload: path.join(__dirname, 'preload.js')
    }
  })

  win.loadFile('index.html')
}

app.whenReady().then(() => {
  createWindow()
})
```

ç°åœ¨æ¸²æŸ“å™¨èƒ½å¤Ÿå…¨å±€è®¿é—® `versions` äº†ï¼Œè®©æˆ‘ä»¬å¿«å¿«å°†é‡Œè¾¹çš„ä¿¡æ¯æ˜¾ç¤ºåœ¨çª—å£ä¸­ã€‚ è¿™ä¸ªå˜é‡ä¸ä»…å¯ä»¥é€šè¿‡ `window.versions` è®¿é—®ï¼Œä¹Ÿå¯ä»¥å¾ˆç®€å•åœ°ä½¿ç”¨ `versions` æ¥è®¿é—®ã€‚ æ–°å»ºä¸€ä¸ª `renderer.js` è„šæœ¬ï¼Œ ä½¿ç”¨ [`document.getElementById`](https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementById) DOM API æ¥æ›¿æ¢ `id` å±æ€§ä¸º `info` çš„ HTML å…ƒç´ çš„æ–‡æœ¬ã€‚

renderer.js

```js
const information = document.getElementById('info')
information.innerText = `æœ¬åº”ç”¨æ­£åœ¨ä½¿ç”¨ Chrome (v${versions.chrome()}), Node.js (v${versions.node()}), å’Œ Electron (v${versions.electron()})`
```

ç„¶åè¯·ä¿®æ”¹ä½ çš„ `index.html` æ–‡ä»¶ã€‚åŠ ä¸Šä¸€ä¸ª `id` å±æ€§ä¸º `info` çš„å…¨æ–°å…ƒç´ ï¼Œå¹¶ä¸”è®°å¾—åŠ ä¸Šä½ çš„ `renderer.js` è„šæœ¬ï¼š

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self'"
    />
    <meta
      http-equiv="X-Content-Security-Policy"
      content="default-src 'self'; script-src 'self'"
    />
    <title>æ¥è‡ª Electron æ¸²æŸ“å™¨çš„é—®å¥½ï¼</title>
  </head>
  <body>
    <h1>æ¥è‡ª Electron æ¸²æŸ“å™¨çš„é—®å¥½ï¼</h1>
    <p>ğŸ‘‹</p>
    <p id="info"></p>
  </body>
  <script src="./renderer.js"></script>
</html>
```



#### åœ¨è¿›ç¨‹ä¹‹é—´é€šä¿¡

æˆ‘ä»¬ä¹‹å‰æåˆ°ï¼ŒElectron çš„ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹æœ‰ç€æ¸…æ¥šçš„åˆ†å·¥å¹¶ä¸”ä¸å¯äº’æ¢ã€‚ è¿™ä»£è¡¨ç€æ— è®ºæ˜¯ä»æ¸²æŸ“è¿›ç¨‹ç›´æ¥è®¿é—® Node.js æ¥å£ï¼Œäº¦æˆ–è€…æ˜¯ä»ä¸»è¿›ç¨‹è®¿é—® HTML æ–‡æ¡£å¯¹è±¡æ¨¡å‹ (DOM)ï¼Œéƒ½æ˜¯ä¸å¯èƒ½çš„ã€‚

è§£å†³è¿™ä¸€é—®é¢˜çš„æ–¹æ³•æ˜¯ä½¿ç”¨è¿›ç¨‹é—´é€šä¿¡ (IPC)ã€‚å¯ä»¥ä½¿ç”¨ Electron çš„ `ipcMain` æ¨¡å—å’Œ `ipcRenderer` æ¨¡å—æ¥è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ã€‚ ä¸ºäº†ä»ä½ çš„ç½‘é¡µå‘ä¸»è¿›ç¨‹å‘é€æ¶ˆæ¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ `ipcMain.handle` è®¾ç½®ä¸€ä¸ªä¸»è¿›ç¨‹å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰ï¼Œç„¶ååœ¨é¢„å¤„ç†è„šæœ¬ä¸­æš´éœ²ä¸€ä¸ªè¢«ç§°ä¸º `ipcRenderer.invoke` çš„å‡½æ•°æ¥è§¦å‘è¯¥å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰ã€‚

æˆ‘ä»¬å°†å‘æ¸²æŸ“å™¨æ·»åŠ ä¸€ä¸ªå«åš `ping()` çš„å…¨å±€å‡½æ•°æ¥æ¼”ç¤ºè¿™ä¸€ç‚¹ã€‚è¿™ä¸ªå‡½æ•°å°†è¿”å›ä¸€ä¸ªä»ä¸»è¿›ç¨‹ç¿»å±±è¶Šå²­è€Œæ¥çš„å­—ç¬¦ä¸²ã€‚

é¦–å…ˆï¼Œåœ¨é¢„å¤„ç†è„šæœ¬ä¸­è®¾ç½® `invoke` è°ƒç”¨ï¼š

```js
const { contextBridge, ipcRenderer } = require('electron')

contextBridge.exposeInMainWorld('versions', {
  node: () => process.versions.node,
  chrome: () => process.versions.chrome,
  electron: () => process.versions.electron,
  ping: () => ipcRenderer.invoke('ping')
  // é™¤å‡½æ•°ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æš´éœ²å˜é‡
})
```

> å¯ä»¥æ³¨æ„åˆ°æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªè¾…åŠ©å‡½æ•°æ¥åŒ…è£¹ `ipcRenderer.invoke('ping')` è°ƒç”¨ï¼Œè€Œå¹¶éç›´æ¥é€šè¿‡ context bridge æš´éœ² `ipcRenderer` æ¨¡å—ã€‚ ä½ **æ°¸è¿œ**éƒ½ä¸ä¼šæƒ³è¦é€šè¿‡é¢„åŠ è½½ç›´æ¥æš´éœ²æ•´ä¸ª `ipcRenderer` æ¨¡å—ã€‚ è¿™å°†ä½¿å¾—ä½ çš„æ¸²æŸ“å™¨èƒ½å¤Ÿç›´æ¥å‘ä¸»è¿›ç¨‹å‘é€ä»»æ„çš„ IPC ä¿¡æ¯ï¼Œä¼šä½¿å¾—å…¶æˆä¸ºæ¶æ„ä»£ç æœ€å¼ºæœ‰åŠ›çš„æ”»å‡»åª’ä»‹ã€‚

ç„¶åï¼Œåœ¨ä¸»è¿›ç¨‹ä¸­è®¾ç½®ä½ çš„ `handle` ç›‘å¬å™¨ã€‚ æˆ‘ä»¬åœ¨ HTML æ–‡ä»¶åŠ è½½*ä¹‹å‰*å®Œæˆäº†è¿™äº›ï¼Œæ‰€ä»¥æ‰èƒ½ä¿è¯åœ¨ä½ ä»æ¸²æŸ“å™¨å‘é€ `invoke` è°ƒç”¨ä¹‹å‰å¤„ç†ç¨‹åºèƒ½å¤Ÿå‡†å¤‡å°±ç»ªã€‚

main.js

```js
const { app, BrowserWindow, ipcMain } = require('electron')
const path = require('node:path')

const createWindow = () => {
  const win = new BrowserWindow({
    width: 800,
    height: 600,
    webPreferences: {
      preload: path.join(__dirname, 'preload.js')
    }
  })
  win.loadFile('index.html')
}
app.whenReady().then(() => {
  ipcMain.handle('ping', () => 'pong')
  createWindow()
})
```

å°†å‘é€å™¨ä¸æ¥æ”¶å™¨è®¾ç½®å®Œæˆä¹‹åï¼Œç°åœ¨ä½ å¯ä»¥å°†ä¿¡æ¯é€šè¿‡åˆšåˆšå®šä¹‰çš„ `'ping'` é€šé“ä»æ¸²æŸ“å™¨å‘é€è‡³ä¸»è¿›ç¨‹å½“ä¸­ã€‚

renderer.js

```js
const func = async () => {
  const response = await window.versions.ping()
  console.log(response) // æ‰“å° 'pong'
}

func()
```

> è¦äº†è§£æ›´è¯¦ç»†çš„å…³äºä½¿ç”¨ `ipcRenderer` å’Œ `ipcMain` æ¨¡å—çš„è¯¦ç»†è¯´æ˜ï¼Œè¯·æŸ¥é˜…å®Œæ•´çš„ [è¿›ç¨‹é—´é€šä¿¡](https://www.electronjs.org/zh/docs/latest/tutorial/ipc) æŒ‡å—ã€‚



## æ·»åŠ åŠŸèƒ½

#### å¢åŠ åº”ç”¨å¤æ‚åº¦

å¦‚æœä½ ä¸€è·¯è·Ÿéšæœ¬æ•™ç¨‹ä¸‹æ¥ï¼Œä½ åº”è¯¥å·²ç»å»ºç«‹äº†ä¸€ä¸ªæ‹¥æœ‰é™æ€ç”¨æˆ·ç•Œé¢çš„åŠŸèƒ½æ€§ Electron ç¨‹åºã€‚ ä»è¿™é‡Œå¼€å§‹ï¼Œä½ å¯ä»¥å¤§æ¦‚ä»ä¸¤ä¸ªå¤§æ–¹å‘ä¸Šè¿›è¡Œå¼€å‘ï¼š

1. å¢åŠ æ¸²æŸ“è¿›ç¨‹çš„ç½‘é¡µåº”ç”¨ä»£ç å¤æ‚åº¦
2. æ·±åŒ–ä¸æ“ä½œç³»ç»Ÿå’Œ Node.js çš„é›†æˆ

äº†è§£è¿™ä¸¤ä¸ªå¤§æ¦‚å¿µä¹‹é—´çš„åŒºåˆ«ååˆ†é‡è¦ã€‚ å°±ç¬¬ä¸€ç‚¹è€Œè¨€ï¼ŒElectron ç‰¹ä¾›çš„èµ„æºæ˜¯éå¿…è¦çš„ã€‚ åœ¨ Electron ä¸­å»ºç«‹ä¸€ä¸ªæ¼‚äº®çš„å¾…åŠåˆ—è¡¨åªæ˜¯å°†ä½ çš„ Electron BrowserWindow æŒ‡å‘ä¸€ä¸ªæ¼‚äº®çš„å¾…åŠåˆ—è¡¨ç½‘ç»œåº”ç”¨ã€‚ è¯´åˆ°åº•ï¼Œä½ è¿˜æ˜¯ä½¿ç”¨åœ¨ Web å¼€å‘ä¸­ç›¸åŒçš„å·¥å…· (HTML, CSS, JavaScript) æ¥æ„å»ºä½ çš„æ¸²æŸ“å™¨ UIã€‚ å› æ­¤ï¼ŒElectron çš„æ–‡æ¡£ä¸ä¼šå¾ˆè¯¦ç»†çš„æ¢è®¨å¦‚ä½•ä½¿ç”¨æ ‡å‡†çš„ Web å·¥å…·è¿›è¡Œå¼€å‘ã€‚

å¦ä¸€æ–¹é¢ï¼ŒElectron åŒæ—¶æä¾›äº†ä¸°å¯Œçš„å·¥å…·é›†ï¼Œå¯ä»¥è®©ä½ å’Œæ¡Œé¢ç¯å¢ƒæ•´åˆèµ·æ¥ã€‚ä»å»ºç«‹æ‰˜ç›˜å›¾æ ‡åˆ°æ·»åŠ å…¨å±€çš„å¿«æ·æ–¹å¼ï¼Œå†åˆ°æ˜¾ç¤ºåŸç”Ÿçš„èœå•ï¼Œéƒ½ä¸åœ¨è¯ä¸‹ã€‚ Electron è¿˜èµ‹äºˆä½ åœ¨ä¸»è¿›ç¨‹ä¸­è®¿é—® Node.js ç¯å¢ƒçš„æ‰€æœ‰èƒ½åŠ›ã€‚ è¿™ç»„èƒ½åŠ›ä½¿å¾— Electron åº”ç”¨èƒ½å¤Ÿä»æµè§ˆå™¨è¿è¡Œç½‘ç«™ä¸­è„±èƒæ¢éª¨ï¼Œå¹¶ä¸”æ˜¯ Electron æ–‡æ¡£çš„é‡ç‚¹ã€‚

#### How-to ç¤ºä¾‹

Electron çš„æ–‡æ¡£æœ‰ç€è®¸å¤šæ•™ç¨‹æ¥å¸®åŠ©ä½ å¤„ç†æ›´é«˜çº§çš„ä¸»é¢˜å’Œæ›´æ·±çš„æ“ä½œç³»ç»Ÿé›†æˆã€‚ è¦å¼€å§‹ä½¿ç”¨ï¼Œè¯·æŸ¥çœ‹ [æ“ä½œæ–¹æ³•ç¤ºä¾‹](https://www.electronjs.org/zh/docs/latest/tutorial/examples) æ–‡æ¡£ã€‚



## æ‰“åŒ…æ‚¨çš„åº”ç”¨ç¨‹åº

#### ä½¿ç”¨ Electron Forge

Electron çš„æ ¸å¿ƒæ¨¡å—ä¸­æ²¡æœ‰æ†ç»‘ä»»ä½•ç”¨äºæ‰“åŒ…æˆ–åˆ†å‘æ–‡ä»¶çš„å·¥å…·ã€‚ å¦‚æœæ‚¨åœ¨å¼€å‘æ¨¡å¼ä¸‹å®Œæˆäº†ä¸€ä¸ª Electron åº”ç”¨ï¼Œéœ€è¦ä½¿ç”¨é¢å¤–çš„å·¥å…·æ¥æ‰“åŒ…åº”ç”¨ç¨‹åº (ä¹Ÿç§°ä¸º**å¯åˆ†å‘æ–‡ä»¶**) å¹¶åˆ†å‘ç»™ç”¨æˆ· ã€‚ å¯åˆ†å‘æ–‡ä»¶å¯ä»¥æ˜¯å®‰è£…ç¨‹åº (ä¾‹å¦‚ Windows ä¸Šçš„ MSI) æˆ–è€…ç»¿è‰²è½¯ä»¶ (ä¾‹å¦‚ macOS ä¸Šçš„ `.app` æ–‡ä»¶)ã€‚

Electron Forge æ˜¯ä¸€ä¸ªå¤„ç† Electron åº”ç”¨ç¨‹åºæ‰“åŒ…ä¸åˆ†å‘çš„ä¸€ä½“åŒ–å·¥å…·ã€‚ åœ¨å·¥å…·åº•å±‚ï¼Œå®ƒå°†è®¸å¤šç°æœ‰çš„ Electron å·¥å…· (ä¾‹å¦‚ [`@electron/packager`](https://github.com/electron/packager)ã€ [`@electron/osx-sign`](https://github.com/electron/osx-sign)ã€[`electron-winstaller`](https://github.com/electron/windows-installer) ç­‰) ç»„åˆåˆ°ä¸€èµ·ï¼Œå› æ­¤æ‚¨ä¸å¿…è´¹å¿ƒå¤„ç†ä¸åŒç³»ç»Ÿçš„æ‰“åŒ…å·¥ä½œã€‚

#### å¯¼å…¥ä½ çš„é¡¹ç›®åˆ° Forge

å°† Electron Forge çš„ CLI å·¥å…·åŒ…å®‰è£…åˆ°é¡¹ç›®çš„ `devDependencies` ä¾èµ–ä¸­ï¼Œç„¶åä½¿ç”¨ç°æˆçš„è½¬åŒ–è„šæœ¬å°†é¡¹ç›®å¯¼å…¥è‡³ Electron Forgeã€‚

```sh
npm install --save-dev @electron-forge/cli
npx electron-forge import
```

è½¬æ¢è„šæœ¬å®Œæˆåï¼ŒForge ä¼šå°†ä¸€äº›è„šæœ¬æ·»åŠ åˆ°æ‚¨çš„ `package.json` æ–‡ä»¶ä¸­ã€‚

```json
  //...
  "scripts": {
    "start": "electron-forge start",
    "package": "electron-forge package",
    "make": "electron-forge make"
  },
  //...
```

æ‚¨è¿˜åº”è¯¥æ³¨æ„åˆ°æ‚¨çš„ package.json ç°åœ¨å®‰è£…äº†æ›´å¤šçš„åŒ… åœ¨ `devDependencies` ä¸‹ï¼Œä»¥åŠä¸€ä¸ªå¯¼å‡ºé…ç½®çš„æ–° `forge.config.js` æ–‡ä»¶ ç›®çš„ã€‚ æ‚¨åº”è¯¥åœ¨é¢„å¡«å……çš„é…ç½®ä¸­çœ‹åˆ°å¤šä¸ªmakersï¼ˆç”Ÿæˆå¯åˆ†å‘åº”ç”¨ç¨‹åºåŒ…çš„åŒ…ï¼‰ï¼Œæ¯ä¸ªç›®æ ‡å¹³å°ä¸€ä¸ªã€‚

#### åˆ›å»ºä¸€ä¸ªå¯åˆ†å‘ç‰ˆæœ¬

è¦åˆ›å»ºå¯åˆ†å‘æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨é¡¹ç›®ä¸­çš„ `make` è„šæœ¬ï¼Œè¯¥è„šæœ¬æœ€ç»ˆè¿è¡Œäº† `electron-forge make` å‘½ä»¤ã€‚

```sh
npm run make
```

è¯¥ `make` å‘½ä»¤åŒ…å«ä¸¤æ­¥ï¼š

1. å®ƒå°†é¦–å…ˆè¿è¡Œ `electron-forge package` ï¼ŒæŠŠæ‚¨çš„åº”ç”¨ç¨‹åº ä»£ç ä¸ Electron äºŒè¿›åˆ¶åŒ…ç»“åˆèµ·æ¥ã€‚ å®Œæˆæ‰“åŒ…çš„ä»£ç å°†ä¼šè¢«ç”Ÿæˆåˆ°ä¸€ä¸ªç‰¹å®šçš„æ–‡ä»¶å¤¹ä¸­ã€‚
2. ç„¶åå®ƒå°†ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸ºæ¯ä¸ª maker é…ç½®ç”Ÿæˆä¸€ä¸ªå¯åˆ†å‘æ–‡ä»¶ã€‚

åœ¨è„šæœ¬è¿è¡Œåï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ä¸€ä¸ª `out` æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…æ‹¬å¯åˆ†å‘æ–‡ä»¶ä¸ä¸€ä¸ªåŒ…å«å…¶æºç çš„æ–‡ä»¶å¤¹ã€‚

```
out/
â”œâ”€â”€ out/make/zip/darwin/x64/my-electron-app-darwin-x64-1.0.0.zip
â”œâ”€â”€ ...
â””â”€â”€ out/my-electron-app-darwin-x64/my-electron-app.app/Contents/MacOS/my-electron-app
```

`out/make` æ–‡ä»¶å¤¹ä¸­çš„åº”ç”¨ç¨‹åºåº”è¯¥å¯ä»¥å¯åŠ¨äº†ï¼ ç°åœ¨ï¼Œæ‚¨å·²ç»åˆ›å»ºäº†ä½ çš„ç¬¬ä¸€ä¸ª Electron ç¨‹åºã€‚

> Electron Forge é€šè¿‡é…ç½®å¯ä»¥ä¸ºä¸åŒçš„æ“ä½œç³»ç»Ÿåˆ›å»ºç‰¹å®šæ ¼å¼çš„å¯åˆ†å‘æ–‡ä»¶ (ä¾‹å¦‚ DMGã€debã€MSI ç­‰)ã€‚ ç›¸å…³é…ç½®é€‰é¡¹è¯¦æƒ…ï¼Œè¯·å‚é˜… Forge çš„ [Makers](https://www.electronforge.io/config/makers) æ–‡æ¡£ã€‚

> è®¾ç½®è‡ªå®šä¹‰çš„åº”ç”¨ç¨‹åºå›¾æ ‡ï¼Œéœ€è¦æ·»åŠ ä¸€äº›é¢å¤–çš„é…ç½®ã€‚ æŸ¥çœ‹ [Forge çš„å›¾æ ‡æ•™ç¨‹](https://www.electronforge.io/guides/create-and-add-icons) äº†è§£æ›´å¤šä¿¡æ¯ã€‚

> å¦‚æœæ‚¨æƒ³æ‰‹åŠ¨æ‰“åŒ…ä»£ç ï¼Œæˆ–è€…æ˜¯æƒ³äº†è§£ Electron çš„æ‰“åŒ…æœºåˆ¶ï¼Œå¯ä»¥æŸ¥çœ‹å®Œæ•´çš„ [åº”ç”¨ç¨‹åºæ‰“åŒ…](https://www.electronjs.org/zh/docs/latest/tutorial/application-distribution) æ–‡æ¡£ã€‚



#### é‡è¦æç¤ºï¼šå¯¹ä»£ç è¿›è¡Œç­¾å

ä¸ºäº†å°†æ¡Œé¢åº”ç”¨ç¨‹åºåˆ†å‘ç»™æœ€ç»ˆç”¨æˆ·ï¼Œæˆ‘ä»¬ *å¼ºçƒˆå»ºè®®* æ‚¨å¯¹ Electron åº”ç”¨è¿›è¡Œ **ä»£ç ç­¾å**ã€‚ ä»£ç ç­¾åæ˜¯äº¤ä»˜æ¡Œé¢åº”ç”¨ç¨‹åºçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå¹¶ä¸”å®ƒå¯¹äºåº”ç”¨ç¨‹åºçš„è‡ªåŠ¨æ›´æ–°åŠŸèƒ½ (å°†ä¼šåœ¨æ•™ç¨‹æœ€åéƒ¨åˆ†è®²è§£) æ¥è¯´æ˜¯å¿…éœ€çš„ã€‚

ä»£ç ç­¾åæ˜¯ä¸€ç§å¯ç”¨äºè¯æ˜æ¡Œé¢åº”ç”¨ç¨‹åºæ˜¯ç”±å·²çŸ¥æ¥æºåˆ›å»ºçš„å®‰å…¨æŠ€æœ¯ã€‚ Windows å’Œ macOS æ‹¥æœ‰å…¶ç‰¹å®šçš„ä»£ç ç­¾åç³»ç»Ÿï¼Œè¿™å°†ä½¿ç”¨æˆ·éš¾ä»¥ä¸‹è½½æˆ–å¯åŠ¨æœªç­¾åçš„åº”ç”¨ç¨‹åºã€‚

åœ¨ macOS ä¸Šï¼Œä»£ç ç­¾åæ˜¯åœ¨åº”ç”¨ç¨‹åºæ‰“åŒ…æ—¶å®Œæˆçš„ã€‚ è€Œåœ¨ Windows ä¸­ï¼Œåˆ™æ˜¯å¯¹å¯åˆ†å‘æ–‡ä»¶è¿›è¡Œç­¾åæ“ä½œã€‚ å¦‚æœæ‚¨å·²ç»æ‹¥æœ‰é€‚ç”¨äº Windows å’Œ macOS çš„ä»£ç ç­¾åè¯ä¹¦ï¼Œå¯ä»¥åœ¨ Forge é…ç½®ä¸­è®¾ç½®æ‚¨çš„å‡­æ®ã€‚

> æ¬²äº†è§£æ›´å¤šä»£ç ç­¾åçš„ä¿¡æ¯ï¼Œè¯·å‚é˜…Forgeæ–‡æ¡£ä¸­çš„ [ç­¾ç½² macOS åº”ç”¨ç¨‹åº](https://www.electronforge.io/guides/code-signing) æŒ‡å—ã€‚

```js
module.exports = {
  packagerConfig: {
    osxSign: {},
    // ...
    osxNotarize: {
      tool: 'notarytool',
      appleId: process.env.APPLE_ID,
      appleIdPassword: process.env.APPLE_PASSWORD,
      teamId: process.env.APPLE_TEAM_ID
    }
    // ...
  }
}
```



## å‘å¸ƒå’Œæ›´æ–°

#### ä½¿ç”¨ update.electronjs.org

Electron å®˜æ–¹åœ¨ [https://update.electronjs.org](https://update.electronjs.org/) ä¸Šä¸ºå¼€æºåº”ç”¨ç¨‹åºæä¾›äº†å…è´¹çš„è‡ªåŠ¨æ›´æ–°æœåŠ¡ã€‚ ä½¿ç”¨å®ƒæœ‰ä»¥ä¸‹å‡ ç‚¹è¦æ±‚ï¼š

- ä½ çš„åº”ç”¨åœ¨ macOS æˆ– Windows ä¸Šè¿è¡Œ
- ä½ çš„åº”ç”¨æœ‰ä¸€ä¸ªå…¬å¼€çš„ GitHub ä»“åº“
- åº”ç”¨ç¨‹åºéœ€è¦å‘å¸ƒåˆ° [GitHub releases](https://docs.github.com/en/repositories/releasing-projects-on-github/managing-releases-in-a-repository) ä¸­
- åº”ç”¨ç¨‹åºéœ€è¦å®Œæˆ [ç­¾å](https://www.electronjs.org/zh/docs/latest/tutorial/code-signing)

è‡³æ­¤ï¼Œæˆ‘ä»¬å‡è®¾ä½ å·²å°†æ‰€æœ‰ä»£ç æ¨é€åˆ°å…¬å¼€çš„ GitHub ä»“åº“ã€‚

> å¦‚æœæ‚¨ä½¿ç”¨äº†å…¶ä»–å­˜å‚¨åº“ä¸»æœº (ä¾‹å¦‚ GitLab æˆ– Bitbucket)ï¼Œæˆ–è€…å¦‚æœæ‚¨ä½ çš„ä»£ç ä»“åº“ä¸èƒ½å…¬å¼€ï¼Œè¯·å‚é˜… [æ›´æ–°åº”ç”¨ç¨‹åº](https://www.electronjs.org/zh/docs/latest/tutorial/updates) æ•™ç¨‹ä»¥æ‰˜ç®¡æ‚¨è‡ªå·±çš„ Electron æ›´æ–°æœåŠ¡å™¨ã€‚

#### å‘å¸ƒä¸€ä¸ª GitHub ç‰ˆæœ¬

Electron Forge çš„ [Publisher](https://www.electronforge.io/config/publishers) æ’ä»¶å¯ä»¥è‡ªåŠ¨å°†æ‰“åŒ…çš„åº”ç”¨ç¨‹åºåˆ†å‘åˆ°å„ç§æ¥æºã€‚ åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¼”ç¤ºä½¿ç”¨ GitHub Publisher å°†ä»£ç å‘å¸ƒåˆ° GitHub releases ä¸­ã€‚

###### ç”Ÿæˆä¸ªäººè®¿é—®ä»¤ç‰Œ

æœªç»è®¸å¯ï¼ŒForgeæ— æ³•å‘GitHub ä¸Šçš„ä»»ä½•ä»“åº“å‘å¸ƒã€‚ ä½ éœ€è¦é€šè¿‡ä¸€ä¸ªè®¤è¯ä»¤ç‰Œï¼Œæˆæƒ Forge ä½¿ç”¨ GitHub çš„å‘å¸ƒåŠŸèƒ½ã€‚ æœ€ç®€å•çš„æ–¹æ³•æ˜¯ [åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸ªäººè®¿é—®ä»¤ç‰Œ (PAT)](https://github.com/settings/tokens/new) èŒƒå›´ä¸º `public_repo`, å®ƒå°†ç»™ä½ çš„å…¬å…±èµ„æºåº“æä¾›å†™è®¿é—®æƒé™ã€‚ **è¯·ç¡®ä¿æ­¤ä»¤ç‰Œä¸å¤–æ³„ã€‚**

###### è®¾ç½® GitHub å‘å¸ƒè€…

Forge çš„ [GitHub Publisher](https://www.electronforge.io/config/publishers/github) æ˜¯ä¸€ä¸ªæ’ä»¶, å®ƒéœ€è¦è¢«å®‰è£…åˆ°ä½ çš„é¡¹ç›®çš„ `devDependencies` é‡Œé¢å»:

```sh
npm install --save-dev @electron-forge/publisher-github
```

ä¸€æ—¦å®‰è£…å®Œæ¯•ï¼Œä½ éœ€è¦åœ¨ Forge é…ç½®ä¸­è®¾ç½®å®ƒã€‚ å®Œæ•´çš„é€‰é¡¹åˆ—è¡¨åœ¨ Forge çš„ [`PublisherGitHubConfig`](https://js.electronforge.io/interfaces/_electron_forge_publisher_github.PublisherGitHubConfig.html) API æ–‡æ¡£ä¸­ã€‚

forge.config.js

```js
module.exports = {
  publishers: [
    {
      name: '@electron-forge/publisher-github',
      config: {
        repository: {
          owner: 'github-user-name',
          name: 'github-repo-name'
        },
        prerelease: false,
        draft: true
      }
    }
  ]
}
```

> è¯·æ³¨æ„ï¼Œä½ å·²é…ç½® Forge æ¥å‘å¸ƒä½ çš„é¡¹ç›®ä½œä¸ºè‰ç¨¿ç‰ˆæœ¬ã€‚ è¿™å°†ä½¿æ‚¨èƒ½å¤Ÿçœ‹åˆ°å…¶ç”Ÿæˆçš„ç»“æœè€Œæ— éœ€å®é™…å‘å¸ƒç»™ä½ çš„æœ€ç»ˆç”¨æˆ·ã€‚ å½“ä½ å†™ä¸‹ç‰ˆæœ¬è¯´æ˜å’Œå¹¶å¤šæ¬¡æ£€æŸ¥åˆ†å‘çš„å·¥ä½œå†…å®¹å, å°±å¯ä»¥æ‰‹åŠ¨åœ¨ Github ä¸Šå‘å¸ƒä½ çš„åº”ç”¨.

ä½ è¿˜éœ€è¦è®©å‘å¸ƒå™¨äº†è§£ä½ çš„èº«ä»½éªŒè¯ä»¤ç‰Œã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†ä½¿ç”¨å­˜å‚¨åœ¨ `GITHUB_TOKEN` ç¯å¢ƒå˜é‡çš„å€¼ã€‚

###### è¿è¡Œå‘å¸ƒå‘½ä»¤

å°† Forge çš„ [å‘å¸ƒå‘½ä»¤](https://www.electronforge.io/cli#publish) æ·»åŠ åˆ° npm è„šæœ¬å†…ã€‚

```json
  //...
  "scripts": {
    "start": "electron-forge start",
    "package": "electron-forge package",
    "make": "electron-forge make",
    "publish": "electron-forge publish"
  },
  //...
```

æ­¤å‘½ä»¤å°†è¿è¡Œä½ é…ç½®çš„åˆ›å»ºæ–¹æ³•å¹¶å°†è¾“å‡ºçš„å¯åˆ†å‘æ–‡ä»¶å‘å¸ƒåˆ°æ–°çš„ GitHub ç‰ˆæœ¬ã€‚

```sh
npm run publish
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™åªä¼šä¸ºä½ å½“å‰çš„ä¸»æœºæ“ä½œç³»ç»Ÿæ¶æ„å‘å¸ƒä¸€ä¸ªå•ä¸€çš„å¯åˆ†å‘æ–‡ä»¶ã€‚ ä½ å¯ä»¥é€šè¿‡å°† `--arch` å‚æ•°ä¼ é€’ç»™ Forge å‘½ä»¤æ¥å‘å¸ƒä¸åŒçš„æ¶æ„ã€‚

ç‰ˆæœ¬çš„åç§°å°†å¯¹åº”äºé¡¹ç›®çš„ package.json æ–‡ä»¶ä¸­çš„ `version` å­—æ®µã€‚

> å¯é€‰çš„, ä½ ä¹Ÿå¯ä»¥ [åœ¨Gitä¸Šå¯¹ç‰ˆæœ¬æ‰“æ ‡ç­¾](https://git-scm.com/book/en/v2/Git-Basics-Tagging), è¿™æ ·ä½ çš„ç‰ˆæœ¬å°†å…³è”åˆ°ä¸€ä¸ªä»£ç å†å²ä¸­çš„æ ‡ç­¾ç‚¹. npmé™„å¸¦äº†ä¸€ä¸ªæ–¹ä¾¿çš„ [`npm version`](https://docs.npmjs.com/cli/v8/commands/npm-version) å‘½ä»¤ï¼Œå¯ä»¥ä¸ºä½ å¤„ç†ç‰ˆæœ¬ç¢°æ’æˆ–æ‰“æ ‡ç­¾.

æœ¬åœ°å‘å¸ƒçš„ç‰ˆæœ¬å¯èƒ½å¾ˆå•ä¸€ï¼Œå› ä¸ºåªèƒ½ä¸ºä½ çš„ä¸»æœºæ“ä½œç³»ç»Ÿåˆ›å»ºä¸€ç§ç‰ˆæœ¬ (æ¯”å¦‚, ä½ ä¸èƒ½ä» macOS ç³»ç»Ÿä¸Šå‘å¸ƒ Window ç³»ç»Ÿçš„ `.exe` æ–‡ä»¶)ã€‚

ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡è‡ªåŠ¨åŒ–å·¥ä½œæµæ¥å‘å¸ƒä½ çš„åº”ç”¨æ¯”å¦‚ [GitHub Actions](https://github.com/features/actions), é€šè¿‡å®ƒå¯ä»¥åœ¨å„ç§äº‘ç³»ç»Ÿå†…åŒ…æ‹¬ Ubuntu, macOS å’Œ Windows ä¸Šè¿è¡Œä»»åŠ¡. è¿™æ˜¯ [Electron Fiddle](https://www.electronjs.org/fiddle) é‡‡ç”¨çš„ç²¾ç¡®æ–¹æ³•. ä½ å¯ä»¥å‚è€ƒ Fiddle çš„ [æ„å»ºå’Œå‘å¸ƒä¸€æ¡é¾™ ](https://github.com/electron/fiddle/blob/main/.github/workflows/build.yaml)ä»¥åŠ [Forge é…ç½®](https://github.com/electron/fiddle/blob/main/forge.config.js) äº†è§£æ›´å¤šè¯¦æƒ…ã€‚



#### æ£€æµ‹æ›´æ–°ç¨‹åºä»£ç 

è‡³æ­¤æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªé€šè¿‡ GitHub å‘å¸ƒçš„åŠŸèƒ½æ€§å‘å¸ƒç³»ç»Ÿï¼Œ æˆ‘ä»¬ç°åœ¨éœ€è¦å‘Šè¯‰æˆ‘ä»¬çš„ Electron åº”ç”¨æ¥ä¸‹è½½æ›´æ–°ï¼Œè€Œä¸”æ˜¯æ¯å½“æ–°ç‰ˆæœ¬å‡ºç°æ—¶éƒ½éœ€è¦æ›´æ–°ã€‚ Electron åº”ç”¨é€šè¿‡ [autoUpdater](https://www.electronjs.org/zh/docs/latest/api/auto-updater) æ¨¡å—æ¥å®ç°æ­¤åŠŸèƒ½, æ­¤æ¨¡å—å¯ä»¥ä»æ›´æ–°æœåŠ¡æºä¸­è¯»å–ä¿¡æ¯, å¹¶æ£€æŸ¥æ˜¯å¦æœ‰ä¸€ä¸ªæ–°ç‰ˆæœ¬å¯ä¾›ä¸‹è½½.

ç½‘å€æ˜¯ update.electronjs.org çš„æœåŠ¡å™¨æä¾›äº†ä¸€ä¸ªå…¼å®¹æ›´æ–°æº. æ¯”å¦‚, Electron Fiddle v0.28.0 å°†ä¼šæ£€æŸ¥æ¥å£ https://update.electronjs.org/electron/fiddle/darwin/v0.28.0 æ¥æŸ¥çœ‹æ˜¯å¦æœ‰æ–°çš„ GitHub ç‰ˆæœ¬å¯ç”¨.

ä¸€æ—¦ä½ çš„å‘å¸ƒç‰ˆæœ¬è¢«æ¨é€åˆ° GitHub, å¯¹åº”çš„æ›´æ–°æœåŠ¡ update.electronjs.org å°†ä¼šè‡ªåŠ¨å¯¹æ¥ä½ çš„åº”ç”¨. å‰©ä¸‹çš„å”¯ä¸€æ­¥éª¤æ˜¯ä½¿ç”¨ autoUpdater æ¨¡å—é…ç½®æºã€‚

ä¸ºäº†è®©æ•´ä¸ªè¿‡ç¨‹æ›´åŠ ç®€å•, Electron å›¢é˜Ÿç»´æŠ¤ [`update-electron-app`](https://github.com/electron/update-electron-app) æ¨¡å—, å®ƒåœ¨ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­ä¸º update.electronjs.org è®¾ç½®äº† autoUpdater æ ·æ¿ï¼Œæ— éœ€é…ç½®ã€‚ è¿™ä¸ªæ¨¡å—å°†æœç´¢ update.electronjs.org æºä¸­ä¸é¡¹ç›®å†… package.json çš„`"repository"` å­—æ®µåŒ¹é…çš„éƒ¨åˆ†ã€‚

é¦–å…ˆï¼Œå®‰è£…æ¨¡å—ä½œä¸ºè¿è¡Œæ—¶çš„ä¾èµ–é¡¹

```sh
npm install update-electron-app
```

ç„¶åå¯¼å…¥æ¨¡å—å¹¶åœ¨ä¸»è¿›ç¨‹ä¸­ç«‹å³è°ƒç”¨

main.js

```js
require('update-electron-app')()
```

è¿™æ˜¯éœ€è¦åšçš„äº‹æƒ…ï¼ ä¸€æ—¦ä½ çš„åº”ç”¨ç¨‹åºè¢«æ‰“åŒ…ï¼Œå®ƒå°†åœ¨ä½ å‘å¸ƒæ¯ä¸ªæ–°çš„ GitHub ç‰ˆæœ¬æ—¶æ›´æ–°è‡ªå·±ã€‚